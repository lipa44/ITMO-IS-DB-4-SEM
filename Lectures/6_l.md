# Лекция 6

## Введение

Нормализация

Для того, чтобы обеспечить целостность, мы будем заниматься денормализацией _(создавать множество связанных таблиц)_.

Это приводит к снижению **производительности**.

> Соединение таблиц - это дорого!

## Как реализуются соединения в SQL

1. Неэффективно (декартово произведение)

```csharp
for (int i = 0; i < R.Count; ++i)
{
    for (int j = 0; j < S.Count; ++j)
    {
        if (R[i].atr != S[j].atr) continue;
        Console.WriteLine(r + s);
    }
}
```

```py
for r in R
    for s in S
        if (r.atr == s.atr)
            print(r + s)
```

2. Эффективно

```py
R.sort(atr)
S.sort(atr)

while not EndOF(S) ans not EndOF(R)
    if (r.atr < s.atr)
        next(R)
    if (r.atr = s.atr)
        print(r + s)
        next(R)
    if (r.atr > s.atr)
        next(S)
```

## Нормализация

**Нормализация** - преобразование отношения к виду, отвечающему нормальной форме.

> **Нормальная форма** - некоторая характеристика отношения.

У нормальных форм есь иерархия: каждая следующая является предыдущей.

## Избыточность

**Студент**

|  Фио  | Группа | Образовательная программа |
| :---: |:------:| :------------------------:|

> Образовательная программа хранится либо у одного студента, либо у всех сразу. В обоих случаях это приводит к своим издержкам.

## Аномалия

1. Модификации

**Аномалия модификации** - изменение значения одной записи привлечёт за собой просмотр всей таблицы и изменения некоторых других записей.

2. Удаления

**Аномалия удаления** - при удалении записи может пропасть и другая информация.

3. Добавления

**Аномалия добавления** - информацию в таблицу нельзя поместить, пока она неполная или требуется дополнительный просмотр табиц.

> Аномалии потенциально приводят нас к нарушению целостности данных.

## Решение проблемы аномалии

**Расширенная таблица студентов**

|  Фио `(PK)` | Группа `(PK)` | Образовательная программа |  Факультет  | Форма обучения |
| :---------: |:-------------:| :-----------------------: |:-----------:| :------------: |


### Функциональная зависимость между аттрибутами

**Функциональная зависимость между аттрибутами** `(X -> Y)` - в отношении R атрибут y функцинально зависит от атрибута x тогда и только тогда, когда каждому значению x соответствует в точности одно значение y.

> Факультет функционально зависит от образовательной программы.

### Частичная функциональная зависимость

**Частичная функциональная зависимость** `(ФИО + Группа) -> Образовательная программа` - зависимость неключевого атрибута от часть составного ключа.

### Полная функциональная зависимость

**Полная функциональная зависимость** `(ФИО + Группа) -> Форма обучения` - неключевой атрибут зависит от всего составного ключа.

### Транзитивная функциональная зависимость

**Транзитивная функциональная зависимость** `(X -> Z, Y: X -> Y && Y -> Z)` - существует такое множество атрибутов Y, что выполняется требование о существовании зависимостей `X -> Y && Y -> Z)`

## Нормальные формы

### Первая нормальная форма

Отношение находится в первой нормальной форме, если все его атрибуты явзяются простыми.

> ФИО мешает нашей таблице соответствовать первой нормальной форме. Для того, чтобы таблица студента находилась в ПНФ, необходимо разделить столбец ФИО на 3 столбца: Ф, И, О

### Вторая нормальная форма

Отношение находится во второй нормальной форме, если оно находится в первой нормальной форме, и каждый неключевой атрибут **функционально полно** зависит от первичного ключа.

|  Ф  |  И  |  О  |  Группа  | Форма обучения |
| :-: | :-: | :-: | :------: | :------------: |

| Группа | Образовательная программа |  Факультет  |
| :----: | :-----------------------: | :---------: |

### Третья нормальная форма

1. Отношение находится в третьей нормальной форме, если оно находится во второй нормальной форме, и все неключевые атрибуты взаимно независимы и полностью зависят от первичного ключа.

2. Отношение находится в третьей нормальной форме, если оно находится во второй нормальной форме, и ни один ключевой атрибут не находится в транзитивной функциональной зависимости от потенциального ключа.

|  Ф  |  И  |  О  |  Группа  | Форма обучения |
| :-: | :-: | :-: | :------: | :------------: |

| Группа | Образовательная программа |
| :----: | :-----------------------: |

| Образовательная программа | Факультет |
| :-----------------------: | :-------: |

### Нормальная форма Бойса-Кодда

**Проекты**

|  Номер студента  |  ФИО  |  Номер проекта  |  Роль  |
| :--------------: | :---: | :-------------: | :----: |

> Данное отношение не соответствует НФ Бойса-Кодда

Отношение находится в нормальной форме Бойса-Кодда, если детерминанты _(зависимые части)_ всех зависимостей являются потенциальными ключами.

#### Приведение к нормальной форме Бойса-Кодда

| Студент | Номер студента | ФИО |
| :-----: | :------------: | :-: |

|  Номер студента  |  Номер проекта  |  Роль  |
| :--------------: | :-------------: | :----: |

### Четвёртая нормальная форма

Отношение находится в четвёртой нормальной форме, если оно находится в нормальной форме Бойса-Кодда, и не содержит многозначных зависимостей.

| Дисциплина | Лектор | Практик |
| :--------: | :----: | :-----: |

> Не соответствует четвёртой нормальной форме, но соответствует всем предыдущим

#### Приведение к четвёртой нормальной форме**

**Лекторы**

| Дисциплина | Лектор |
| :--------: | :----: |

**Практики**

| Дисциплина | Практик |
| :--------: | :-----: |

> Вопрос приведения к четвёртой нормальной форме - вопрос **интерпритации** данных.

> Пятая и шестая нормальные формы - это плюс на экламене :)

## Денормализация

Денормализация - искуственная декомпозиция нескольких отношений для уменьшения количества операций в запросе.
